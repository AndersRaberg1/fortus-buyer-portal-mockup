{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/andersraberg/buyer-portal-mockup/src/app/invoices/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useDropzone } from 'react-dropzone';\nimport { useState, useEffect } from 'react';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n\nexport default function Invoices() {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [result, setResult] = useState<any>(null);\n  const [invoices, setInvoices] = useState<any[]>([]);\n\n  const fetchInvoices = async () => {\n    const { data, error } = await supabase\n      .from('invoices')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (error) console.error('Supabase fetch error:', error);\n    else setInvoices(data || []);\n  };\n\n  useEffect(() => {\n    fetchInvoices();\n  }, []);\n\n  const onDrop = async (acceptedFiles: File[]) => {\n    if (acceptedFiles.length === 0) return;\n    setLoading(true);\n    setError(null);\n    setResult(null);\n\n    const formData = new FormData();\n    formData.append('file', acceptedFiles[0]);\n\n    try {\n      const res = await fetch('/api/extract-pdf', { method: 'POST', body: formData });\n      const data = await res.json();\n      if (!res.ok) throw new Error(data.error);\n      setResult(data);\n      fetchInvoices(); // Uppdatera lista\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: { 'application/pdf': ['.pdf'], 'image/*': [] },\n    maxFiles: 1,\n  });\n\n  return (\n    <div className=\"p-6 max-w-4xl mx-auto pb-20 md:pb-6\">\n      <h2 className=\"text-2xl font-bold mb-6\">Fakturor & ordrar</h2>\n\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow p-8 mb-8\">\n        <p className=\"font-medium mb-6\">Ladda upp ny faktura</p>\n        <div className=\"border-2 border-dashed rounded-xl p-12 text-center\" {...getRootProps()}>\n          <input {...getInputProps()} />\n          {isDragActive ? <p>Släpp här...</p> : <p>Dra och släpp PDF/bild eller klicka</p>}\n        </div>\n\n        {loading && <p className=\"text-center text-primary mt-6\">Bearbetar med OCR...</p>}\n        {error && <p className=\"text-red-600 text-center mt-6\">{error}</p>}\n\n        {result && (\n          <div className=\"mt-8 bg-green-50 dark:bg-green-900/20 rounded-xl p-6\">\n            <h3 className=\"font-bold mb-4\">Extraherad data</h3>\n            <p><strong>Belopp:</strong> {result.parsed.amount}</p>\n            <p><strong>Förfallodatum:</strong> {result.parsed.dueDate}</p>\n            <p><strong>Leverantör:</strong> {result.parsed.supplier}</p>\n            <p><strong>Fakturanummer:</strong> {result.parsed.invoiceNumber}</p>\n            <p><strong>OCR-nummer:</strong> {result.parsed.ocrNumber}</p>\n            <p className=\"mt-4 text-green-600 font-medium\">{result.message}</p>\n          </div>\n        )}\n      </div>\n\n      <h3 className=\"text-xl font-bold mb-6\">Sparade fakturor</h3>\n      {invoices.length === 0 ? (\n        <p className=\"text-gray-500\">Inga fakturor sparade än.</p>\n      ) : (\n        <div className=\"space-y-6\">\n          {invoices.map((inv) => (\n            <div key={inv.id} className=\"bg-white dark:bg-gray-800 rounded-xl shadow p-6\">\n              <p><strong>Belopp:</strong> {inv.parsed_data.amount}</p>\n              <p><strong>Förfallodatum:</strong> {inv.parsed_data.dueDate}</p>\n              <p><strong>Leverantör:</strong> {inv.parsed_data.supplier}</p>\n              <p><strong>Fakturanummer:</strong> {inv.parsed_data.invoiceNumber}</p>\n              <p><strong>OCR-nummer:</strong> {inv.parsed_data.ocrNumber}</p>\n              <a href={inv.pdf_url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"mt-4 inline-block bg-primary text-white px-4 py-2 rounded-lg\">\n                Öppna PDF\n              </a>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}"],"names":[],"mappings":"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"}}]
}