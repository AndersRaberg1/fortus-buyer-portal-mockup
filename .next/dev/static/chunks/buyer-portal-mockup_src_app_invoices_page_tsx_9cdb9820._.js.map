{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/andersraberg/buyer-portal-mockup/src/app/invoices/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useDropzone } from 'react-dropzone';\nimport { useState, useEffect } from 'react';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n\nexport default function Invoices() {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [result, setResult] = useState<any>(null);\n  const [invoices, setInvoices] = useState<any[]>([]);\n\n  const fetchInvoices = async () => {\n    const { data, error } = await supabase\n      .from('invoices')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (error) console.error('Supabase fetch error:', error);\n    else setInvoices(data || []);\n  };\n\n  useEffect(() => {\n    fetchInvoices();\n  }, []);\n\n  const onDrop = async (acceptedFiles: File[]) => {\n    if (acceptedFiles.length === 0) return;\n    setLoading(true);\n    setError(null);\n    setResult(null);\n\n    const formData = new FormData();\n    formData.append('file', acceptedFiles[0]);\n\n    try {\n      const res = await fetch('/api/extract-pdf', { method: 'POST', body: formData });\n      const data = await res.json();\n      if (!res.ok) throw new Error(data.error);\n      setResult(data);\n      fetchInvoices(); // Uppdatera lista\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: { 'application/pdf': ['.pdf'], 'image/*': [] },\n    maxFiles: 1,\n  });\n\n  return (\n    <div className=\"p-6 max-w-4xl mx-auto pb-20 md:pb-6\">\n      <h2 className=\"text-2xl font-bold mb-6\">Fakturor & ordrar</h2>\n\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow p-8 mb-8\">\n        <p className=\"font-medium mb-6\">Ladda upp ny faktura</p>\n        <div className=\"border-2 border-dashed rounded-xl p-12 text-center\" {...getRootProps()}>\n          <input {...getInputProps()} />\n          {isDragActive ? <p>Släpp här...</p> : <p>Dra och släpp PDF/bild eller klicka</p>}\n        </div>\n\n        {loading && <p className=\"text-center text-primary mt-6\">Bearbetar med OCR...</p>}\n        {error && <p className=\"text-red-600 text-center mt-6\">{error}</p>}\n\n        {result && (\n          <div className=\"mt-8 bg-green-50 dark:bg-green-900/20 rounded-xl p-6\">\n            <h3 className=\"font-bold mb-4\">Extraherad data</h3>\n            <p><strong>Belopp:</strong> {result.parsed.amount}</p>\n            <p><strong>Förfallodatum:</strong> {result.parsed.dueDate}</p>\n            <p><strong>Leverantör:</strong> {result.parsed.supplier}</p>\n            <p><strong>Fakturanummer:</strong> {result.parsed.invoiceNumber}</p>\n            <p><strong>OCR-nummer:</strong> {result.parsed.ocrNumber}</p>\n            <p className=\"mt-4 text-green-600 font-medium\">{result.message}</p>\n          </div>\n        )}\n      </div>\n\n      <h3 className=\"text-xl font-bold mb-6\">Sparade fakturor</h3>\n      {invoices.length === 0 ? (\n        <p className=\"text-gray-500\">Inga fakturor sparade än.</p>\n      ) : (\n        <div className=\"space-y-6\">\n          {invoices.map((inv) => (\n            <div key={inv.id} className=\"bg-white dark:bg-gray-800 rounded-xl shadow p-6\">\n              <p><strong>Belopp:</strong> {inv.parsed_data.amount}</p>\n              <p><strong>Förfallodatum:</strong> {inv.parsed_data.dueDate}</p>\n              <p><strong>Leverantör:</strong> {inv.parsed_data.supplier}</p>\n              <p><strong>Fakturanummer:</strong> {inv.parsed_data.invoiceNumber}</p>\n              <p><strong>OCR-nummer:</strong> {inv.parsed_data.ocrNumber}</p>\n              <a href={inv.pdf_url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"mt-4 inline-block bg-primary text-white px-4 py-2 rounded-lg\">\n                Öppna PDF\n              </a>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}"],"names":["useDropzone","useState","useEffect","createClient","supabase","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","Invoices","loading","setLoading","error","setError","result","setResult","invoices","setInvoices","fetchInvoices","data","from","select","order","ascending","console","onDrop","acceptedFiles","File","length","formData","FormData","append","res","fetch","method","body","json","ok","Error","err","message","getRootProps","getInputProps","isDragActive","accept","maxFiles","parsed","amount","dueDate","supplier","invoiceNumber","ocrNumber","map","inv","id","parsed_data","pdf_url"],"mappings":"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","ignoreList":[]}}]
}